# This is the minimum version number required.
fastlane_version "1.110.0"

default_platform :ios

platform :ios do

  desc "Build an adhoc distribution version"
  desc "This will also make sure the profile is up to date"
  lane :adhoc do
    xcargs = {}
    if is_ci?
      # import the private key
      signing_assets = File.join(ENV['TRAVIS_BUILD_DIR'], 'travis_signing_assets.p12')
      keychain = File.join(ENV['TRAVIS_BUILD_DIR'], 'travis.keychain')
      FastlaneCore::KeychainImporter.import_file(signing_assets, keychain, 
        keychain_password: 'travis', certificate_password: ENV['TRAVIS_KEY_PASSWORD'])
      profile_uuid = sigh(adhoc: true)
      xcargs = {
        'PROVISIONING_PROFILE_app' => profile_uuid
      }
    end
    gym(scheme: 'AutomaticSigning', xcargs: xcargs)
  end

end
